  version: 2.1

  orbs:
    #sonarcloud: sonarsource/sonarcloud@1.0.1
    #sonarcloud-dotnet: ksmc/sonarcloud-dotnet@0.0.9

  jobs:
    build:
      docker:
        - image: mcr.microsoft.com/dotnet/core/sdk:3.1
      steps:
        - checkout
        #- sonarcloud-dotnet/setup-sonar
        - run: dotnet tool install --global dotnet-sonarscanner --version 4.8.0
        - run: echo "deb http://ftp.us.debian.org/debian stretch main contrib non-free" >> /etc/apt/sources.list
        - run: apt update
        - run: apt install -y unzip
        - run: dotnet sonarscanner begin /k:kafka-streams-dotnet /o:LGouellec /d:sonar.login=${SONAR_TOKEN} /d:sonar.host.url=https://sonarcloud.io
        #- sonarcloud-dotnet/run-scan
        #    project_key: 
        #    organization: 
        - run: dotnet build
        - run: 
            when: always
            command: dotnet sonarscanner end /d:sonar.login=${SONAR_TOKEN}
        #- sonarcloud-dotnet/end-scan
        #- sonarcloud/scan

  workflows:
    main:
      jobs:
        - build:
            context: SonarCloud